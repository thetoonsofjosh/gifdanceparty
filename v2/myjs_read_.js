
var ALL_DANCERS = [
{ name: "alexg", artist: "", category: "irl" },
{ name: "alienhands", artist: "", category: "" },
{ name: "alientwerk", artist: "", category: "" },
{ name: "anxietyonline", artist: "", category: "overlay" },
{ name: "baldi", artist: "", category: "" },
{ name: "banana", artist: "", category: "" },
{ name: "banginralph", artist: "", category: "irl" },
{ name: "bearjustin", artist: "", category: "irl" },
{ name: "bearpump", artist: "", category: "" },
{ name: "bighead", artist: "", category: "" },
{ name: "bitcarlton", artist: "", category: "" },
{ name: "bodyspin", artist: "", category: "" },
{ name: "boomercan", artist: "", category: "irl" },
{ name: "boomersdoink", artist: "", category: "" },
{ name: "brainbeer", artist: "", category: "" },
{ name: "bunnybabe", artist: "", category: "" },
{ name: "bunnyspank", artist: "", category: "" },
{ name: "cactusgroove", artist: "", category: "" },
{ name: "cd", artist: "", category: "overlay" },
{ name: "clapping", artist: "", category: "overlay" },
{ name: "classy", artist: "", category: "irl" },
{ name: "cowboyoof", artist: "", category: "irl" },
{ name: "cowboyspin", artist: "", category: "irl" },
{ name: "crazyhandguy", artist: "", category: "" },
{ name: "crazyliz", artist: "", category: "" },
{ name: "crochalien", artist: "", category: "irl" },
{ name: "dannyd", artist: "", category: "irl" },
{ name: "dinochill", artist: "", category: "" },
{ name: "dinohump", artist: "", category: "" },
{ name: "dinoshuffle", artist: "", category: "" },
{ name: "discoball", artist: "", category: "overlay" },
{ name: "doggy", artist: "", category: "" },
{ name: "doggydog", artist: "", category: "" },
{ name: "doggyshuffle", artist: "", category: "irl" },
{ name: "eggman", artist: "", category: "" },
{ name: "elfy", artist: "", category: "" },
{ name: "elvenbooty", artist: "", category: "" },
{ name: "explosion", artist: "", category: "overlay" },
{ name: "fabio", artist: "", category: "" },
{ name: "fatspidey", artist: "", category: "" },
{ name: "fitness1", artist: "jasonclarke", category: "" },
{ name: "fitnessbooty", artist: "jasonclarke", category: "" },
{ name: "fred", artist: "", category: "" },
{ name: "freedom", artist: "", category: "" },
{ name: "froggyfresh", artist: "", category: "overlay" },
{ name: "fuzzyside", artist: "", category: "" },
{ name: "gblaster", artist: "", category: "overlay" },
{ name: "getdown", artist: "", category: "irl" },
{ name: "gloves", artist: "", category: "irl" },
{ name: "gorilla", artist: "", category: "" },
{ name: "greenman", artist: "", category: "irl" },
{ name: "greything", artist: "", category: "" },
{ name: "grooveowl", artist: "", category: "" },
{ name: "halflife", artist: "", category: "" },
{ name: "headbang", artist: "", category: "" },
{ name: "hellicopter", artist: "", category: "" },
{ name: "hipdog", artist: "", category: "" },
{ name: "honeybooboo", artist: "", category: "irl" },
{ name: "hotdog", artist: "", category: "" },
{ name: "humpery", artist: "", category: "" },
{ name: "internetparty", artist: "", category: "overlay" },
{ name: "isthisdani", artist: "", category: "irl" },
{ name: "italiandisco", artist: "", category: "" },
{ name: "jankeyguy", artist: "", category: "" },
{ name: "japandoll", artist: "", category: "" },
{ name: "jasonc1", artist: "", category: "irl" },
{ name: "jellyworm", artist: "", category: "" },
{ name: "jro", artist: "", category: "irl" },
{ name: "justcarlton", artist: "", category: "irl" },
{ name: "kermy", artist: "", category: "" },
{ name: "kitty", artist: "", category: "" },
{ name: "kittytrombone", artist: "", category: "" },
{ name: "lshark", artist: "", category: "" },
{ name: "lsquid", artist: "", category: "" },
{ name: "mandarin", artist: "", category: "" },
{ name: "makeitrain", artist: "", category: "" },
{ name: "maranda", artist: "", category: "irl" },
{ name: "michj", artist: "", category: "" },
{ name: "mushroom", artist: "", category: "" },
{ name: "ned", artist: "", category: "" },
{ name: "noshorts", artist: "", category: "irl" },
{ name: "orangeguy", artist: "", category: "" },
{ name: "orangemike", artist: "", category: "" },
{ name: "pa", artist: "", category: "irl" },
{ name: "pixelbabes", artist: "", category: "" },
{ name: "purplecat", artist: "", category: "" },
{ name: "psycho", artist: "", category: "irl" },
{ name: "rainbow", artist: "", category: "overlay" },
{ name: "rainbowwheel", artist: "", category: "overlay" },
{ name: "ralphcan", artist: "", category: "irl" },
{ name: "raveon", artist: "", category: "overlay" },
{ name: "ravecat", artist: "", category: "" },
{ name: "ravekitty", artist: "", category: "" },
{ name: "refwalk", artist: "", category: "" },
{ name: "robothump", artist: "", category: "" },
{ name: "rockkitty", artist: "", category: "" },
{ name: "scorpion", artist: "", category: "" },
{ name: "scummyb", artist: "", category: "irl" },
{ name: "sidereach", artist: "jasonclarke", category: "" },
{ name: "sitonyou", artist: "", category: "irl" },
{ name: "skullpump", artist: "", category: "" },
{ name: "smooch", artist: "", category: "" },
{ name: "spagett", artist: "", category: "overlay" },
{ name: "spongeybob", artist: "", category: "" },
{ name: "spinglitch", artist: "", category: "" },
{ name: "textbanger", artist: "", category: "overlay" },
{ name: "textfeelmusic", artist: "", category: "overlay" },
{ name: "textparyarrived", artist: "", category: "overlay" },
{ name: "textyougothacked", artist: "", category: "overlay" },
{ name: "thedj", artist: "", category: "overlay" },
{ name: "thehop", artist: "", category: "irl" },
{ name: "thewizard", artist: "", category: "irl" },
{ name: "theworm", artist: "", category: "" },
{ name: "tripstand", artist: "", category: "" },
{ name: "trippypoly", artist: "", category: "" },
{ name: "tummy", artist: "", category: "" },
{ name: "twerk", artist: "", category: "irl" },
{ name: "veryman", artist: "", category: "" },
{ name: "wariopump", artist: "", category: "" },
{ name: "wasntme", artist: "", category: "irl" },
{ name: "wildarms", artist: "", category: "" },
{ name: "waluigipump", artist: "", category: "" },
{ name: "weedguy", artist: "", category: "" },
{ name: "woah", artist: "", category: "" },
{ name: "xray", artist: "", category: "" },
{ name: "yeti", artist: "", category: "" },
];

$(document).ready(function(){
	for(var i=0;i<ALL_DANCERS.length;i++){
		if(ALL_DANCERS[i].category==""){
			var img_html = '<img class="img_thumb" id="'+ALL_DANCERS[i].name+'" data-category="'+ALL_DANCERS[i].category+'" src="dancegifs/small/'+ALL_DANCERS[i].name+'_100.gif" height="100">';
			$('#character_dancers').append(img_html);
		}
	}
	$('#character_dancers').append('<div style="clear:both;"></div><div class="full-height"></div>');
	for(var i=0;i<ALL_DANCERS.length;i++){
		if(ALL_DANCERS[i].category=="irl"){
			var img_html = '<img class="img_thumb" id="'+ALL_DANCERS[i].name+'" data-category="'+ALL_DANCERS[i].category+'" src="dancegifs/small/'+ALL_DANCERS[i].name+'_100.gif" height="100">';
			$('#irl_dancers').append(img_html);
		}
	}
	$('#irl_dancers').append('<div style="clear:both;"></div><div class="full-height"></div>');
	for(var i=0;i<ALL_DANCERS.length;i++){
		if(ALL_DANCERS[i].category=="overlay"){
			var img_html = '<img class="img_thumb" id="'+ALL_DANCERS[i].name+'" data-category="'+ALL_DANCERS[i].category+'" src="dancegifs/small/'+ALL_DANCERS[i].name+'_100.gif" height="100">';
			$('#overlays_fx').append(img_html);
		}
	}
	$('#overlays_fx').append('<div style="clear:both;"></div><div class="full-height"></div>');
});


var min_depth = 499;
var max_depth = 501;
var DANCER_COUNT = 0;
var gif_max_width = 600;
var gif_max_height = 800;
var gif_min_width = 120;
var is_dragging = false;
var global_volume = 70;

var ALL_SCENES = [
	{name:"dancefloor_1.jpg"},
	{name:"dancefloor_7b.jpg"},
	{name:"dancefloor_8.jpg"},
	{name:"burnm.jpg"},
	{name:"dancefloor_5.jpg"},
	{name:"dancefloor_6.jpg"},
	{name:"sadroom2.jpg"},
	{name:"dancefloor_9.jpg"},
	{name:"berghain.jpg"},
	{name:"dancefloor_11.jpg"},
	{name:"dancefloor_13.jpg"},
	{name:"dancefloor_14b.jpg"},
	{name:"dancefloor_10.jpg"},
	{name:"dancefloor_2.jpg"},
];
var SCENE_INDEX = 1;

var ALL_SONGS = [
	{name:"gdp_halffull.mp3"},
	{name:"gdp_nopanties.mp3"},
	{name:"gdp_walkmen.mp3"},
	{name:"gdp_money2.mp3"},
	{name:"gdp_spiltmilk.mp3"},
	{name:"gdp_bubblebutt.mp3"},
	{name:"gdp_nahnah.mp3"},
	{name:"gdp_rex.mp3"},
	{name:"dgdp_whitehorse.mp3"},
	{name:"gdp_singalong.mp3"}
];
var SONG_INDEX = 1;
var myGroup; //buzz sounds group
var song_num = 0;













$(document).ready(function(){


	// INIT ___________________________________________________________________________________________
	$("#whiteout").fadeOut(250);
	$("#irl_dancers").hide();
	$("#overlays_fx").hide();
	$("#dancers_container").hide();
	$("#artists_container").hide();
	$("#about_container").hide();
	$("#dancefloor").backstretch("backgrounds/"+ALL_SCENES[SCENE_INDEX].name);
	preload();
	

	$("#firstclick_button").click(function(){
		$("#firstclick_button,#firstclick_text").fadeOut(250);
		setTimeout(()=>{
			buzz.sounds[song_num].play().setVolume(global_volume);
		},500);
		setTimeout(()=>{
			$("#firstclick_container").fadeOut(250);
		},1000);
	});

	// CHANGE SCENE _______________________________________________________________________________________________
	$("#button_scene").click(function(){
		SCENE_INDEX++;
		if(SCENE_INDEX>=ALL_SCENES.length){SCENE_INDEX=0;}
		$("#dancefloor").backstretch("backgrounds/"+ALL_SCENES[SCENE_INDEX].name);
	});

	// CHANGE SCENE _______________________________________________________________________________________________
	$("#button_music").click(function(){
		song_num++;
		if(song_num>buzz.sounds.length-1){song_num=0;}
		myGroup.stop(); 
		buzz.sounds[song_num].play().setVolume(global_volume);
	});

	// DANCERS _______________________________________________________________________________________________
	$("#button_dancers").click(function(){
		$("#dancers_container").fadeIn(250);
		responsive();
	});
	$("#close_dancers").click(function(){
		$("#dancers_container").fadeOut(250);
		responsive();
	});
	$(".dancerstype").click(function(){
		$(".dancers_type_container").hide();
		$("#dancers_characters,#dancers_irl,#dancers_fx").css("text-decoration","none");
		if($(this).attr("id")==="dancers_characters"){
			$("#character_dancers").fadeIn(250);
			$("#dancers_characters").css("text-decoration","underline");
		}
		if($(this).attr("id")==="dancers_irl"){
			$("#irl_dancers").fadeIn(250);
			$("#dancers_irl").css("text-decoration","underline");
		}
		if($(this).attr("id")==="dancers_fx"){
			$("#overlays_fx").fadeIn(250);
			$("#dancers_fx").css("text-decoration","underline");
		}
	});

	// ADD A DANCER _______________________________________________________________________________________________
	$(document.body).on('click', '.img_thumb' ,function(){
		var name = $(this).attr("id");
		var category = $(this).attr("data-category");
		add_a_dancer(name,category);
		$("#dancers_container").fadeOut(250);
	});

	// MOUSE ENTER/LEAVE DANCER _______________________________________________________________________________________________
	$(document).on('mouseenter','.dance_outter',function(){ 
		if(is_dragging===false){
			$('.dance_outter').css("background-color","rgba(20,20,20,0.0)");
			$('.dance_outter').css("border","none");
			$('.dance_outter').children("div:not(:first-child)").hide();
			$('.dance_outter').find(".ui-resizable-handle").hide();
			$('.dance_outter').find(".ui-resizable-se").hide();
			$(this).css("background-color","rgba(20,20,20,0.25)");
			$(this).css({"border-width":"1px","border-style":"dashed","border-color":"#ccc"});
			$(this).children("div:not(:first-child)").show();
			$(this).find(".ui-resizable-handle").show();
			$(this).find(".ui-resizable-se").show();
		}
	});
	$(document).on('mouseleave','.dance_outter',function(){ 
		if(is_dragging===false){
			$(this).css("background-color","rgba(20,20,20,0.0)");
			$(this).css("border","none");
			$(this).children("div:not(:first-child)").hide();
			$(this).find(".ui-resizable-handle").hide();
			$(this).find(".ui-resizable-se").hide();
			$(this).find(".dancer_shadow").show();
		}
	});

	// REMOVE DANCER _______________________________________________________________________________________________
	$(document).on('click','.close_dancer',function(){
		var uid = $(this).closest(".dance_outter").attr("id");
		$("#"+uid).remove();
	});

	// FRONT/BACK DANCER _______________________________________________________________________________________________
	$(document).on('click','.bfront',function(){
		var uid = $(this).closest(".dance_outter").attr("id");
		max_depth++;
		$("#"+uid).css("z-index",max_depth);
	});
	$(document).on('click','.bback',function(){
		var uid = $(this).closest(".dance_outter").attr("id");
		min_depth--;
		$("#"+uid).css("z-index",min_depth);
	});

	// CLONE DANCER _______________________________________________________________________________________________
	$(document).on('click','.clone_dancer',function(){
		var x = parseInt($(this).closest(".dance_outter").css("left"));
		var y = parseInt($(this).closest(".dance_outter").css("top"));
		var z = parseInt($(this).closest(".dance_outter").css("z-index"));
		var w = parseInt($(this).closest(".dance_outter").css("width"));
		console.log(x+","+y+","+z+","+w);
		var uid = $(this).attr("id");
		var name = $(this).attr("data-name");
		var category = $(this).attr("data-category");
		add_a_dancer(name,category,x,y,z,w);
	});

	// FLIP DANCER _______________________________________________________________________________________________
	$(document).on('click','.hflip',function(){
		var uid = $(this).closest(".dance_outter").attr("id");
	    var flip_element = $("#"+uid).find(".dancer");
	    if(flip_element.attr("data-flip")==="false"){
	      flip_element.addClass("flip-h");
	      flip_element.attr("data-flip","true");
	    }else{
	      flip_element.removeClass("flip-h");
	      flip_element.attr("data-flip","false");
	    }
	});

	// ABOUT _______________________________________________________________________________________________
	$("#button_about").click(function(){
		$("#about_container").fadeIn(250);
		responsive();
	});
	$("#close_about").click(function(){
		$("#about_container").fadeOut(250);
		responsive();
	});

	// ARTISTS _______________________________________________________________________________________________
	$("#button_artists").click(function(){
		$("#artists_container").fadeIn(250);
		responsive();
	});
	$("#close_artists").click(function(){
		$("#artists_container").fadeOut(250);
		responsive();
	});

});











//________________________________________________________ INIT DEFAULT DANCEFLOOR
function init_default(){ 

	/*
	makeitrain [x:0.41,y:0.41,w:0.18]
	pixelbabes [x:0.33,y:0.28,w:0.36]
	ned [x:0.08,y:0.45,w:0.29]
	baldi [x:0.67,y:0.41,w:0.26]
	*/
	var bw = parseInt($("body").width());
	var bh = parseInt($("body").height());
	add_a_dancer("makeitrain","", 0.41*bw, 0.41*bh, 501, 0.18*bw, true);
	add_a_dancer("pixelbabes","", 0.33*bw, 0.28*bh, 502, 0.36*bw, true);
	add_a_dancer("ned","", 0.08*bw, 0.45*bh, 503, 0.29*bw, true);
	add_a_dancer("baldi","", 0.67*bw, 0.41*bh, 504, 0.26*bw, true);
	max_depth = 505;

	
}














//___________________________________________________________________________________ ADD A DANCER

function add_a_dancer(name,category,_x,_y,_z,_w,preload){

	if(_x===undefined||_x===null){
		var x = 100;
		var y = 100;
		max_depth++;
		var z = max_depth;
		var uid = name+makeid();
		var w = 250;
	}else if(preload===true){
		var x = _x;
		var y = _y;
		var z = _z;
		var w = _w;
		var uid = name+makeid();
	}else{ //on clone we pass vals
		var x = _x - _w - (20*Math.random());
		if(x<0){x=10;}
		var y = _y;
		var z = _z + 1;
		var uid = name+makeid();
		var w = _w;
	}

	$("#dancefloor").append("<div class='dance_outter' id='"+uid+"' data-name='"+name+"' style='z-index:"+z+";top:"+y+"px;left:"+x+"px;width:auto;height:auto;'>"+
							   "<div class='resizer' style='width:"+w+"px;height:auto;'>"+
							     "<img class='dancer' data-flip='false' src='dancegifs/original/"+name+".gif' width='100%'>"+
							   "</div>"+
							   "<img class='shadow' src='img/dancer_shadow.png' width='100%'>"+
							   "<div class='hflip dfont'>FLIP</div>"+
							   "<div class='bfront dfont'>FRONT</div>"+
							   "<div class='bback dfont'>BACK</div>"+
							   "<div class='resize_help dfont2'>RESIZE</div>"+
							   "<div class='close_dancer dfont'>X</div>"+
							   "<div class='clone_dancer dfont' id='"+uid+"' data-name='"+name+"'>CLONE</div>"+
							 "</div>");

	all_resizable();
	all_draggable();

	$("#"+uid).find(".ui-resizable-handle").hide();
	$("#"+uid).find(".ui-resizable-se").hide();
	$("#"+uid).children("div:not(:first-child)").hide();
	$("#"+uid).find(".dancer_shadow").show();
	if(category==="overlay"){
		$("#"+uid).find(".shadow").remove(); //no shadow for overlay
	}

	// var w = parseInt($("#"+uid).find(".shadow").css("width"));
	// $("#"+uid).find(".shadow").css("margin-bottom",(-w/8)+"px");

	DANCER_COUNT++;

}






















//___________________________________________________________________________________ RESIZABLE

function all_resizable(){ 
	$(".resizer").resizable({
		aspectRatio: true,
		minWidth: 120,
		maxWidth: gif_max_width,
		maxHeight: gif_max_height,
		resize:function(event,ui){
			$(this).parent().css("width",ui.size.width+"px").css("height",ui.size.height+"px");
			var wPct = parseFloat( ui.size.width / parseInt($("body").width()) );
			console.log('pct width: ' + wPct);
		},
		stop:function(event,ui){
			//nothing
		}
	});
}

//___________________________________________________________________________________ DRAGGABLE

function all_draggable(){ 
	$(".dance_outter").draggable({
		scroll: false,
		start:function(){
			is_dragging = true;
		},
		drag: function(event,ui){ 
            var offset = $(this).offset();
            var xPct = parseFloat( offset.left / parseInt($("body").width()) );
            var yPct = parseFloat( offset.top / parseInt($("body").height()) );
            console.log('pct x: ' + xPct);
            console.log('pct y: ' + yPct);
		},
		stop:function(event,ui){
            is_dragging = false;
		}
	});
}
























//___________________________________________________________________________________ PRELOAD
function preload(){ 

	var loader = new PxLoader(); 
	for(var i=0;i<ALL_SCENES.length;i++){
		loader.addImage("backgrounds/"+ALL_SCENES[SCENE_INDEX].name);	
	}
	loader.addCompletionListener(function() { 
	    done_preload();
	}); 
	loader.start(); 

	buzz.defaults.loop = true;
	buzz.defaults.formats = ['mp3'];
	buzz.defaults.preload = 'auto';
	buzz.defaults.autoplay = false;
	var money = new buzz.sound("music/gdp_money2"); money.set("id","money");
	var spiltmilk = new buzz.sound("music/spilt_milk_neighbor_128"); spiltmilk.set("id","spiltmilk");
	var singalong = new buzz.sound("music/gdp_singalong"); singalong.set("id","singalong");
	var rex = new buzz.sound("music/rex_the_dog_128"); rex.set("id","rex");
	var whitehorse = new buzz.sound("music/gdp_whitehorse"); whitehorse.set("id", "whitehorse");
	var halffull = new buzz.sound("music/gdp_halffull"); halffull.set("id","halffull");
	var nopanties = new buzz.sound("music/gdp_nopanties"); nopanties.set("id","nopanties");
	var walkmen = new buzz.sound("music/gdp_walkmen"); walkmen.set("id","walkmen");
	myGroup = new buzz.group([rex,money,walkmen,whitehorse,spiltmilk,singalong,nopanties,halffull]); 

	myGroup.setVolume(global_volume);
	

}
function done_preload(){
	console.log("preload complete");
	init_default();
	setTimeout(()=>{
		$("#loading_container").fadeOut(250);
	},3000);
}

//___________________________________________________________________________________ OTHER FUNCTIONS

function makeid(){
  var text = "";
  var possible = "abcdefghijklmnopqrstuvwxyz";
  for (var i = 0; i < 8; i++)
    text += possible.charAt(Math.floor(Math.random() * possible.length));
  return text;
}


//___________________________________________________________________________________ RESPONSIVENESS

function responsive(){
	$(".centerxy").each(function(){ $(this).center(1,1); });
	$(".centerx").each(function(){ $(this).center(1,0); });
	$(".centery").each(function(){ $(this).center(0,1); });
}
$(window).load(function(){
	responsive()
});
$(document).ready(function(){
	responsive()
});
$(window).resize(function(){
	responsive()
});
$.fn.center = function(x,y){
	if(x==1){this.css("left", Math.max(0, (($(this).parent().width() - $(this).outerWidth()) / 2) ) + "px");}
	if(y==1){this.css("top", Math.max(0, (($(this).parent().height() - $(this).outerHeight()) / 2) ) + "px");}
	return this;
};






document.addEventListener('contextmenu', event => event.preventDefault());








